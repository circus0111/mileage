<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AM é ˜èˆªå“¡ï¼šå…¨åŠŸèƒ½æ——è‰¦ç‰ˆ v17</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
  <style>
      :root { --primary: #5D8AA8; --secondary: #88B04B; --danger: #E07A5F; --uni: #FF8C00; --cube: #00A36C; --dbs: #003399; --bg: #F4F7F6; --card: #FFFFFF; --text: #2C3E50; --sub: #7F8C8D; }
      body { font-family: sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 15px 15px 80px 15px; }
      .container { max-width: 900px; margin: 0 auto; }
      .card { background: var(--card); border-radius: 12px; padding: 18px; margin-bottom: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
      h2 { font-size: 1.1em; border-left: 4px solid var(--primary); padding-left: 10px; margin: 0 0 15px 0; }
      .monitor-card { border: 1px solid #D1E1EB; background: #F0F7FA; position: sticky; top: 0; z-index: 10; }
      .stat-box { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; font-size: 0.85em; }
      .progress-container { background: #E0E0E0; border-radius: 10px; height: 10px; margin: 8px 0; overflow: hidden; }
      .progress-bar { height: 100%; transition: width 0.6s; background: var(--primary); }
      .brand-chips { display: flex; gap: 4px; margin-top: 8px; flex-wrap: wrap; }
      .chip { font-size: 0.65em; padding: 3px 8px; border-radius: 12px; background: #EEE; color: #999; border: 1px solid #DDD; }
      .chip.active { background: var(--uni); color: white; border-color: var(--uni); font-weight: bold; }
      .form-row { display: flex; flex-direction: column; margin-bottom: 12px; }
      label { font-size: 0.8em; color: var(--sub); margin-bottom: 4px; }
      input, select { padding: 10px; border: 1px solid #DDD; border-radius: 8px; font-size: 1em; }
      .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
      .btn-main { width: 100%; padding: 14px; border: none; border-radius: 8px; cursor: pointer; font-size: 1em; background: var(--primary); color: white; font-weight: bold; }
      .table-wrapper { overflow-x: auto; }
      table { width: 100%; border-collapse: collapse; font-size: 0.85em; min-width: 450px; }
      th, td { padding: 12px 8px; border-bottom: 1px solid #EEE; text-align: left; }
      .nav-bar { position: fixed; bottom: 0; left: 0; right: 0; background: white; display: flex; justify-content: space-around; padding: 12px; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); z-index: 100; }
      .nav-item { text-align: center; font-size: 0.8em; cursor: pointer; color: var(--sub); flex: 1; }
      .nav-item.active { color: var(--primary); font-weight: bold; }
      .hidden { display: none; }
      .reward-tag { font-size: 0.8em; padding: 2px 5px; border-radius: 4px; background: #f0f0f0; margin-top: 2px; display: inline-block; }
      .asset-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
      .asset-item { background: #f9f9f9; padding: 10px; border-radius: 8px; border-left: 3px solid var(--primary); }
  </style>
</head>
<body>

<div class="container">
  <div class="card monitor-card">
      <div class="stat-box">
          <span style="font-weight:bold;">âœˆï¸ é‡Œç¨‹ç›®æ¨™é€²åº¦</span>
          <span style="color:var(--primary); font-weight:bold;"><span id="currentMilesDisp">0</span> / <span id="targetMilesDisp">0</span> AM</span>
      </div>
      <div class="progress-container"><div id="goalBar" class="progress-bar" style="background:var(--secondary);"></div></div>
      
      <div class="stat-box"><span>ğŸ’³ æ˜Ÿå±• 10% (ä¸Šé™ $11,363)</span><span>$<span id="dbsSpentDisp">0</span></span></div>
      <div class="progress-container"><div id="dbsBar" class="progress-bar" style="background:var(--dbs);"></div></div>

      <div class="stat-box" style="color:var(--uni); font-weight:bold;"><span>ğŸ¦ Uniopen ä»»å‹™ ($12,500)</span><span id="uniStatus">0 å“ç‰Œ</span></div>
      <div class="progress-container"><div id="uniBar" class="progress-bar" style="background:var(--uni);"></div></div>
      <div class="brand-chips" id="brandChips">
          <span class="chip" data-brand="711">7-11</span><span class="chip" data-brand="starbucks">æ˜Ÿå·´å…‹</span><span class="chip" data-brand="carrefour">å®¶æ¨‚ç¦</span><span class="chip" data-brand="cosmed">åº·æ˜¯ç¾</span><span class="chip" data-brand="smile">é€Ÿé‚æ¨‚</span><span class="chip" data-brand="others">å…¶ä»–çµ±ä¸€</span>
      </div>
      <div id="monthlyRewardSummary" style="font-size: 0.75em; color: var(--sub); margin-top: 10px; text-align: center; border-top: 1px solid #ddd; padding-top: 5px;">
          æœ¬æœˆç´¯è¨ˆå›é¥‹ï¼š<span id="monthPoints">ç„¡è³‡æ–™</span>
      </div>
  </div>

  <div id="sec-entry" class="section">
      <div class="card">
          <h2>æ–°å¢æ¶ˆè²»</h2>
          <div class="grid-2">
            <div class="form-row"><label>æ—¥æœŸ</label><input type="date" id="txDate" onchange="recalc()"></div>
            <div class="form-row"><label>æ”¯ä»˜å¡ç‰‡</label><select id="txCard" onchange="toggleCardInputs()"><option value="UNIOPEN">ä¸­ä¿¡ Uniopen</option><option value="DBS">æ˜Ÿå±•å‚³èªªå°æ±º</option><option value="CUBE">åœ‹æ³° CUBE</option><option value="OTHER">å…¶ä»–</option></select></div>
          </div>
          <div class="form-row"><label>æ¶ˆè²»æè¿°</label><input type="text" id="txDesc" placeholder="ä¾‹å¦‚ï¼šåŠ æ²¹ã€åˆé¤ã€ç¶²è³¼"></div>
          <div class="grid-2">
              <div class="form-row"><label>é‡‘é¡</label><input type="number" id="txAmt" oninput="recalc()"></div>
              <div class="form-row"><label>é¡åˆ¥</label><select id="txCat"><option>é¤é£²ç¾é£Ÿ</option><option>äº¤é€šå‡ºè¡Œ</option><option>è³¼ç‰©æ¶ˆè²»</option><option>å±…å®¶ç”Ÿæ´»</option><option>ä¼‘é–’å¨›æ¨‚</option><option>å…¶ä»–</option></select></div>
          </div>

          <div id="uniInputs">
            <div class="grid-2">
                <div class="form-row"><label>æ”¯ä»˜æ–¹å¼</label><select id="txMethod" onchange="recalc()"><option value="PHYSICAL">å¯¦é«”/æ„Ÿæ‡‰</option><option value="ICASH_PAY">icash Pay (+4%)</option></select></div>
                <div class="form-row"><label>çµ±ä¸€å“ç‰Œ</label><select id="txBrand" onchange="recalc()"><option value="NONE">éçµ±ä¸€é€šè·¯</option><option value="711">7-11</option><option value="starbucks">æ˜Ÿå·´å…‹</option><option value="carrefour">å®¶æ¨‚ç¦</option><option value="cosmed">åº·æ˜¯ç¾</option><option value="smile">é€Ÿé‚æ¨‚ (Smile)</option><option value="others">å…¶ä»–çµ±ä¸€</option></select></div>
            </div>
          </div>

          <div id="cubeInputs" class="hidden">
            <div class="form-row"><label>CUBE æ¬Šç›Šæ–¹æ¡ˆ (æ‰‹å‹•é¸æ“‡)</label>
                <select id="cubePlan" onchange="recalc()">
                    <option value="3">æ¨‚é¥—è³¼ / ç©æ•¸ä½ / è¶£æ—…è¡Œ (3%)</option>
                    <option value="2">é›†ç²¾é¸ (2%) - 7-11/å…¨å®¶/å®¶æ¨‚ç¦</option>
                    <option value="0.3">ä¸€èˆ¬æ¶ˆè²» (0.3%)</option>
                </select>
            </div>
          </div>

          <div id="prePreview" style="background:#F9F9F9; padding:12px; border-radius:8px; font-size:0.95em; margin-top:10px; border:1px dashed #DDD;">
              é è¨ˆç²å¾—ï¼š<span id="preTotal" style="font-weight:bold; color:var(--primary);">è«‹è¼¸å…¥é‡‘é¡</span>
          </div>
          <button onclick="commitTx()" class="btn-main" style="margin-top:15px;">ç¢ºèªè¨˜å¸³</button>
      </div>
  </div>

  <div id="sec-miles" class="section hidden">
      <div class="card">
          <h2>é»æ•¸éŒ¢åŒ… (AM æ›ç®—)</h2>
          <div class="asset-grid" id="assetSummary"></div>
      </div>
      <div class="card">
          <h2>æ‰‹å‹•é»æ•¸è®Šå‹• (è£œé»/å…Œæ›)</h2>
          <div class="grid-2">
              <select id="adjType">
                  <option value="AM">AM å¯¦é«”é‡Œç¨‹</option><option value="DBS_PT">æ˜Ÿå±•é»</option><option value="OPEN_PT">OP é»</option>
                  <option value="LINE_PT">LP é»</option><option value="CUBE_PT">å°æ¨¹é»</option><option value="HAMI_PT">Hamié»</option>
                  <option value="HG_PT">HappyGo</option><option value="TS_PT">å°æ–°é»</option>
              </select>
              <input type="number" id="adjVal" placeholder="+/- é»æ•¸">
          </div>
          <div class="form-row" style="margin-top:10px;"><label>èª¿æ•´èªªæ˜</label><input type="text" id="adjReason" placeholder="ä¾‹å¦‚ï¼šæ‰‹å‹•å…Œæ›è£œå„Ÿ"></div>
          <button onclick="commitAdj()" class="btn-main" style="background:var(--secondary); margin-top:10px;">æ›´æ–°é»æ•¸</button>
      </div>
      <div class="card">
          <h2>é»æ•¸æµæ°´å¸³</h2>
          <div class="table-wrapper"><table id="ledgerTable"><thead><tr><th>æ—¥æœŸ</th><th>ä¾†æº</th><th>è®Šå‹•</th><th>é‡Œç¨‹</th><th>åˆª</th></tr></thead><tbody></tbody></table></div>
      </div>
  </div>

  <div id="sec-history" class="section hidden">
      <div class="card">
          <h2>æ¶ˆè²»ç´€éŒ„èˆ‡å·¥å…·</h2>
          <div class="grid-2" style="margin-bottom:15px;">
              <button onclick="exportExcel()" style="background:#2ecc71; color:white; border:none; padding:10px; border-radius:8px;">åŒ¯å‡º Excel</button>
              <button onclick="document.getElementById('importFile').click()" style="background:#3498db; color:white; border:none; padding:10px; border-radius:8px;">åŒ¯å…¥å‚™ä»½</button>
              <input type="file" id="importFile" style="display:none;" onchange="importExcel(event)">
          </div>
          <div class="table-wrapper"><table id="txTable"><thead><tr><th>æ—¥æœŸ</th><th>é …ç›®</th><th>å¡ç‰‡/é‡‘é¡</th><th>å›é¥‹çµæœ</th><th>åˆª</th></tr></thead><tbody></tbody></table></div>
      </div>
  </div>

  <div id="sec-settings" class="section hidden">
      <div class="card"><h2>æ¶ˆè²»é¡åˆ¥åˆ†æ</h2><div style="height:220px;"><canvas id="statChart"></canvas></div></div>
      <div class="card">
          <h2>AM é‡Œç¨‹ç›®æ¨™èˆ‡å…Œæ›æ¯”ä¾‹</h2>
          <div class="grid-2">
              <div class="form-row"><label>ç›®æ¨™é‡Œç¨‹ (AM)</label><input type="number" id="setGoalTarget"></div>
              <div class="form-row"><label>é¡¯ç¤ºåç¨±</label><input type="text" id="setGoalName"></div>
          </div>
          <h3>å„é¡é»æ•¸ âœ 1 AM æ¯”ä¾‹</h3>
          <div id="rateInputs" class="grid-2"></div>
          <button onclick="saveSettings()" class="btn-main" style="margin-top:15px;">å„²å­˜è¨­å®š</button>
      </div>
      <button onclick="clearAll()" style="width:100%; color:var(--danger); border:1px solid var(--danger); background:none; padding:10px; border-radius:8px;">æ¸…ç©ºæ‰€æœ‰è³‡æ–™</button>
  </div>
</div>

<div class="nav-bar">
  <div class="nav-item active" onclick="nav('entry')">è¨˜å¸³</div>
  <div class="nav-item" onclick="nav('miles')">é‡Œç¨‹</div>
  <div class="nav-item" onclick="nav('history')">æ­·å²</div>
  <div class="nav-item" onclick="nav('settings')">è¨­å®š</div>
</div>

<script>
  let state = JSON.parse(localStorage.getItem('am_uni_v17')) || {
      records: [], adjusts: [], goal: { name: "é‡Œç¨‹ç›®æ¨™", target: 84000 },
      rates: { AM: 1, DBS_PT: 2, OPEN_PT: 0.25, LINE_PT: 0.2, CUBE_PT: 0.36, HAMI_PT: 0.33, HG_PT: 0.25, TS_PT: 0.55 }
  };

  function toggleCardInputs() {
      const card = document.getElementById('txCard').value;
      document.getElementById('uniInputs').classList.toggle('hidden', card !== 'UNIOPEN');
      document.getElementById('cubeInputs').classList.toggle('hidden', card !== 'CUBE');
      recalc();
  }

  function getMonthStats() {
      const now = new Date();
      const m = now.getMonth();
      const y = now.getFullYear();
      const mRecs = state.records.filter(r => {
          const d = new Date(r.date);
          return d.getMonth() === m && d.getFullYear() === y;
      });
      const brands = new Set(mRecs.filter(r => r.cardKey === 'UNIOPEN' && r.brand && r.brand !== 'NONE').map(r => r.brand));
      const dbsSpent = mRecs.filter(r => r.cardKey === 'DBS').reduce((sum, r) => sum + r.amt, 0);
      const uniSpent = mRecs.filter(r => r.cardKey === 'UNIOPEN').reduce((sum, r) => sum + r.amt, 0);

      // æœ¬æœˆç´¯è¨ˆç²å¾—é»æ•¸åŠ ç¸½
      let monthPts = {};
      mRecs.forEach(r => {
          const res = calculateRowReward(r, {brandCount: brands.size});
          if(res.ptAmount > 0) {
              const k = res.ptName;
              monthPts[k] = (monthPts[k] || 0) + res.ptAmount;
          }
      });
      const ptStr = Object.entries(monthPts).map(([k,v]) => `${v} ${k}`).join(' | ') || "ç›®å‰æš«ç„¡å›é¥‹";

      return { brandCount: brands.size, brands: Array.from(brands), dbsSpent, uniSpent, ptStr };
  }

  function calculateRowReward(r, s) {
      let ptAmount = 0, ptName = "", ptKey = "";
      if (r.cardKey === 'DBS') {
          ptAmount = Math.round(r.amt * (r.amt <= 11363 ? 0.1 : 0.012));
          ptName = "DBS"; ptKey = "DBS_PT";
      } else if (r.cardKey === 'UNIOPEN') {
          let rate = 0.01;
          if(r.brand !== 'NONE') rate += 0.02;
          if(r.method === 'ICASH_PAY') rate += 0.04;
          if(s.brandCount >= 5) rate += 0.04;
          if(r.brand === 'smile' && r.method === 'ICASH_PAY') {
              const d = new Date(r.date).getDay();
              if([2, 4, 6].includes(d)) rate += 0.06;
          }
          ptAmount = Math.round(r.amt * rate);
          ptName = "OP"; ptKey = "OPEN_PT";
      } else if (r.cardKey === 'CUBE') {
          ptAmount = Math.round(r.amt * (parseFloat(r.cubePlan || 3) / 100));
          ptName = "å°æ¨¹"; ptKey = "CUBE_PT";
      }
      return { ptAmount, ptName, ptKey, amTotal: Math.round(ptAmount * (state.rates[ptKey] || 0)) };
  }

  function refreshUI() {
      const s = getMonthStats();
      let totalAM = state.adjusts.reduce((sum, a) => sum + (parseFloat(a.amt) * (state.rates[a.type] || 0)), 0);
      state.records.forEach(r => { 
          const rw = calculateRowReward(r, s);
          totalAM += rw.amTotal; 
      });

      document.getElementById('currentMilesDisp').innerText = Math.round(totalAM).toLocaleString();
      document.getElementById('targetMilesDisp').innerText = state.goal.target.toLocaleString();
      document.getElementById('goalBar').style.width = Math.min(100, (totalAM/state.goal.target)*100) + "%";
      document.getElementById('dbsSpentDisp').innerText = Math.round(s.dbsSpent).toLocaleString();
      document.getElementById('dbsBar').style.width = Math.min(100, (s.dbsSpent/11363)*100) + "%";
      document.getElementById('uniStatus').innerText = `${s.brandCount} å“ç‰Œ`;
      document.getElementById('uniBar').style.width = Math.min(100, (s.uniSpent/12500)*100) + "%";
      document.getElementById('monthPoints').innerText = s.ptStr;
      document.querySelectorAll('.chip').forEach(c => c.classList.toggle('active', s.brands.includes(c.dataset.brand)));

      renderAsset(s); renderHistory(s); renderLedger(s);
  }

  function renderLedger(s) {
      let ledger = state.adjusts.map(a => ({ ...a, isManual: true }));
      state.records.forEach(r => {
          const rw = calculateRowReward(r, s);
          if(rw.ptAmount > 0) ledger.push({ id: r.id, date: r.date, type: rw.ptKey, amt: rw.ptAmount, reason: r.desc, isManual: false, am: rw.amTotal });
      });
      ledger.sort((a,b) => new Date(b.date) - new Date(a.date));
      document.querySelector('#ledgerTable tbody').innerHTML = ledger.map(l => `<tr><td><small>${l.date.slice(5)}</small></td><td>${l.isManual ? '[èª¿]' : '[è²»]'} ${l.reason}</td><td>${l.amt} ${l.type.replace('_PT','')}</td><td style="color:var(--primary); font-weight:bold;">${Math.round(l.am || l.amt*(state.rates[l.type]||0))}</td><td>${l.isManual ? `<button onclick="delAdj(${l.id})" style="border:none;background:none;color:red;">âŒ</button>` : ''}</td></tr>`).join('');
  }

  function renderHistory(s) {
      document.querySelector('#txTable tbody').innerHTML = state.records.map(r => {
          const rw = calculateRowReward(r, s);
          return `<tr><td>${r.date.slice(5)}</td><td>${r.desc}</td><td><small>${r.cardKey}</small><br>$${r.amt.toLocaleString()}</td><td>${rw.ptAmount}${rw.ptName}<br><b>${rw.amTotal} AM</b></td><td><button onclick="delRec(${r.id})" style="border:none;background:none;color:red;">âŒ</button></td></tr>`;
      }).join('');
  }

  function renderAsset(s) {
      document.getElementById('assetSummary').innerHTML = Object.entries(state.rates).map(([k,v]) => {
          let count = state.adjusts.filter(a=>a.type===k).reduce((sum,a)=>sum+parseFloat(a.amt), 0);
          count += state.records.reduce((sum, r) => { const rw = calculateRowReward(r, s); return rw.ptKey === k ? sum + rw.ptAmount : sum; }, 0);
          return `<div class="asset-item"><div style="font-size:0.7em; color:var(--sub);">${k.replace('_PT','')}</div><div style="font-weight:bold; font-size:1em;">${Math.round(count).toLocaleString()}</div><div style="font-size:0.75em; color:var(--primary);">â‰ˆ ${Math.round(count*v).toLocaleString()} AM</div></div>`;
      }).join('');
  }

  function renderChart() {
      const ctx = document.getElementById('statChart').getContext('2d');
      if(window.myChart) window.myChart.destroy();
      const cats = ["é¤é£²ç¾é£Ÿ","äº¤é€šå‡ºè¡Œ","è³¼ç‰©æ¶ˆè²»","å±…å®¶ç”Ÿæ´»","ä¼‘é–’å¨›æ¨‚","å…¶ä»–"];
      const data = cats.map(c => state.records.reduce((sum, r) => r.cat===c?sum+r.amt:sum, 0));
      window.myChart = new Chart(ctx, { type: 'doughnut', data: { labels: cats, datasets: [{ data, backgroundColor: ['#FF6384','#36A2EB','#FFCE56','#4BC0C0','#9966FF','#FF9F40'] }] }, options: { maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { boxWidth: 12, font: { size: 10 } } } } } });
  }

  function recalc() {
      const card = document.getElementById('txCard').value;
      const amt = parseFloat(document.getElementById('txAmt').value) || 0;
      const s = getMonthStats();
      const res = calculateRowReward({ date: document.getElementById('txDate').value, amt, cardKey: card, method: document.getElementById('txMethod').value, brand: document.getElementById('txBrand').value, cubePlan: document.getElementById('cubePlan').value }, s);
      document.getElementById('preTotal').innerText = res.ptAmount ? `${res.ptAmount} ${res.ptName} / ${res.amTotal} AM` : "è«‹è¼¸å…¥é‡‘é¡";
  }

  function commitTx() {
      const amt = parseFloat(document.getElementById('txAmt').value);
      if(!amt) return alert("è«‹è¼¸å…¥é‡‘é¡");
      state.records.unshift({ id: Date.now(), date: document.getElementById('txDate').value, cat: document.getElementById('txCat').value, desc: document.getElementById('txDesc').value, amt, cardKey: document.getElementById('txCard').value, method: document.getElementById('txMethod').value, brand: document.getElementById('txBrand').value, cubePlan: document.getElementById('cubePlan').value });
      save(); document.getElementById('txAmt').value = ''; document.getElementById('txDesc').value = '';
  }

  function commitAdj() {
      const val = parseFloat(document.getElementById('adjVal').value);
      if(!val) return alert("è«‹è¼¸å…¥é»æ•¸");
      state.adjusts.unshift({ id: Date.now(), date: new Date().toISOString().split('T')[0], type: document.getElementById('adjType').value, amt: val, reason: document.getElementById('adjReason').value || "æ‰‹å‹•èª¿æ•´" });
      save(); document.getElementById('adjVal').value = ''; document.getElementById('adjReason').value = '';
  }

  function saveSettings() {
      state.goal.name = document.getElementById('setGoalName').value;
      state.goal.target = parseInt(document.getElementById('setGoalTarget').value);
      Object.keys(state.rates).forEach(k => { state.rates[k] = parseFloat(document.getElementById('rate_'+k).value); });
      save(); alert("è¨­å®šå·²å„²å­˜");
  }

  function exportExcel() {
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(state.records), "Records");
    XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(state.adjusts), "Adjusts");
    XLSX.writeFile(wb, "AM_Backup_v17.xlsx");
  }

  function importExcel(e) {
    const reader = new FileReader();
    reader.onload = (f) => {
        const data = XLSX.read(new Uint8Array(f.target.result), {type: 'array'});
        state.records = XLSX.utils.sheet_to_json(data.Sheets["Records"]);
        if(data.Sheets["Adjusts"]) state.adjusts = XLSX.utils.sheet_to_json(data.Sheets["Adjusts"]);
        save(); location.reload();
    };
    reader.readAsArrayBuffer(e.target.files[0]);
  }

  function save() { localStorage.setItem('am_uni_v17', JSON.stringify(state)); refreshUI(); }
  function delRec(id) { if(confirm("ç¢ºå®šåˆªé™¤æ­¤ç­†æ¶ˆè²»ï¼Ÿ")) { state.records = state.records.filter(r=>r.id!==id); save(); } }
  function delAdj(id) { if(confirm("ç¢ºå®šåˆªé™¤æ­¤ç­†èª¿æ•´ï¼Ÿ")) { state.adjusts = state.adjusts.filter(a=>a.id!==id); save(); } }
  function clearAll() { if(confirm("é€™å°‡æœƒæ¸…é™¤æ‰€æœ‰è¨˜å¸³ç´€éŒ„èˆ‡é»æ•¸è³‡ç”¢ï¼Œç¢ºå®šå—ï¼Ÿ")) { localStorage.clear(); location.reload(); } }
  function nav(id) { document.querySelectorAll('.section').forEach(s => s.classList.add('hidden')); document.getElementById('sec-' + id).classList.remove('hidden'); document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active')); event.currentTarget.classList.add('active'); if(id === 'settings') setTimeout(renderChart, 100); }

  // åˆå§‹åŒ–
  document.getElementById('txDate').valueAsDate = new Date();
  document.getElementById('setGoalName').value = state.goal.name;
  document.getElementById('setGoalTarget').value = state.goal.target;
  document.getElementById('rateInputs').innerHTML = Object.keys(state.rates).map(k => `<div class="form-row"><label>${k.replace('_PT','')}</label><input type="number" step="0.01" id="rate_${k}" value="${state.rates[k]}"></div>`).join('');
  refreshUI();
</script>
</body>
</html>

