<!DOCTYPE html>
<html lang="zh-TW">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>AM é ˜èˆªå“¡ x Uniopenï¼šå°ˆæ¥­å…¨èƒ½ç‰ˆ</title>
   <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
   <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
   <style>
       :root {
           --primary: #5D8AA8; --secondary: #88B04B; --danger: #E07A5F; --uni: #FF8C00;
           --bg: #F4F7F6; --card: #FFFFFF; --text: #2C3E50; --sub: #7F8C8D;
       }
       body { font-family: sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 15px 15px 80px 15px; }
       .container { max-width: 900px; margin: 0 auto; }
       .card { background: var(--card); border-radius: 12px; padding: 18px; margin-bottom: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
       h2 { font-size: 1.1em; border-left: 4px solid var(--primary); padding-left: 10px; margin: 0 0 15px 0; }
       
       /* å„€è¡¨æ¿ */
       .monitor-card { border: 1px solid #D1E1EB; background: #F0F7FA; position: sticky; top: 0; z-index: 10; }
       .stat-box { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; font-size: 0.85em; }
       .progress-container { background: #E0E0E0; border-radius: 10px; height: 8px; margin-bottom: 8px; overflow: hidden; }
       .progress-bar { height: 100%; transition: width 0.5s; background: var(--primary); }

       /* Uniopen ä»»å‹™ */
       .brand-chips { display: flex; gap: 4px; margin-top: 5px; flex-wrap: wrap; }
       .chip { font-size: 0.65em; padding: 2px 6px; border-radius: 10px; background: #EEE; color: #999; border: 1px solid #DDD; }
       .chip.active { background: var(--uni); color: white; border-color: var(--uni); font-weight: bold; }

       /* è¡¨å–® */
       .form-row { display: flex; flex-direction: column; margin-bottom: 12px; }
       label { font-size: 0.8em; color: var(--sub); margin-bottom: 4px; }
       input, select { padding: 10px; border: 1px solid #DDD; border-radius: 8px; font-size: 1em; }
       .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
       .btn-main { width: 100%; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-size: 1em; background: var(--primary); color: white; margin-top: 5px; }

       /* è¡¨æ ¼èˆ‡åˆ—è¡¨ */
       .table-wrapper { overflow-x: auto; }
       table { width: 100%; border-collapse: collapse; font-size: 0.85em; }
       th, td { padding: 10px 8px; border-bottom: 1px solid #EEE; text-align: left; }
       .tag { font-size: 0.7em; padding: 2px 4px; border-radius: 4px; background: #EEE; margin-right: 3px; }
       .reward-op { color: var(--uni); font-weight: bold; }
       .reward-am { color: var(--primary); font-weight: bold; }

       .nav-bar { position: fixed; bottom: 0; left: 0; right: 0; background: white; display: flex; justify-content: space-around; padding: 10px; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); z-index: 100; }
       .nav-item { text-align: center; font-size: 0.75em; cursor: pointer; color: var(--sub); flex: 1; }
       .nav-item.active { color: var(--primary); font-weight: bold; }
       .hidden { display: none; }
   </style>
</head>
<body>

<div class="container">
   <div class="card monitor-card">
       <div class="stat-box">
           <span>âœˆï¸ <span id="goalNameDisp">é‡Œç¨‹ç›®æ¨™</span></span>
           <span><span id="currentMilesDisp">0</span> / <span id="targetMilesDisp">0</span> AM</span>
       </div>
       <div class="progress-container"><div id="goalBar" class="progress-bar" style="background:var(--secondary);"></div></div>

       <div class="stat-box">
           <span>ğŸ’³ æ˜Ÿå±• 10% (ä¸Šé™ $11,363)</span>
           <span>å·²åˆ· $<span id="dbsSpentDisp">0</span></span>
       </div>
       <div class="progress-container"><div id="dbsBar" class="progress-bar"></div></div>

       <div class="stat-box" style="color:var(--uni); font-weight:bold;">
           <span>ğŸ¦ Uniopen ä»»å‹™ ($12,500)</span>
           <span id="uniStatus">0 å“ç‰Œ (3%)</span>
       </div>
       <div class="progress-container"><div id="uniBar" class="progress-bar" style="background:var(--uni);"></div></div>
       
       <div class="stat-box" style="font-size: 0.75em; color: var(--sub);">
           <span>ğŸ“± icash Pay åŠ ç¢¼ (ä¸Šé™ $3,750)</span>
           <span>$<span id="icashSpentDisp">0</span></span>
       </div>
       <div class="progress-container"><div id="icashBar" class="progress-bar" style="background:#FFB347;"></div></div>

       <div class="brand-chips" id="brandChips">
           <span class="chip" data-brand="711">7-11</span><span class="chip" data-brand="starbucks">æ˜Ÿå·´å…‹</span>
           <span class="chip" data-brand="carrefour">å®¶æ¨‚ç¦</span><span class="chip" data-brand="cosmed">åº·æ˜¯ç¾</span>
           <span class="chip" data-brand="others">å…¶ä»–çµ±ä¸€</span>
       </div>
   </div>

   <div id="sec-entry" class="section">
       <div class="card">
           <h2>æ–°å¢æ¶ˆè²»ç´€éŒ„</h2>
           <div class="grid-2">
               <div class="form-row"><label>æ—¥æœŸ</label><input type="date" id="txDate"></div>
               <div class="form-row"><label>åˆ†é¡</label>
                   <select id="txCat">
                       <option value="é¤é£²ç¾é£Ÿ">ğŸ½ï¸ é¤é£²ç¾é£Ÿ</option><option value="äº¤é€šå‡ºè¡Œ">ğŸš— äº¤é€šå‡ºè¡Œ</option>
                       <option value="è³¼ç‰©æ¶ˆè²»">ğŸ›ï¸ è³¼ç‰©æ¶ˆè²»</option><option value="å±…å®¶ç”Ÿæ´»">ğŸ  å±…å®¶ç”Ÿæ´»</option>
                       <option value="ä¼‘é–’å¨›æ¨‚">ğŸ® ä¼‘é–’å¨›æ¨‚</option><option value="å…¶ä»–">â“ å…¶ä»–</option>
                   </select>
               </div>
           </div>
           <div class="form-row"><label>é …ç›®åç¨±</label><input type="text" id="txDesc" placeholder="ä¾‹å¦‚ï¼šç™¾è²¨å…¬å¸è³¼ç‰©"></div>
           <div class="grid-2">
               <div class="form-row"><label>é‡‘é¡ (TWD)</label><input type="number" id="txAmt" oninput="recalc()"></div>
               <div class="form-row"><label>æ”¯ä»˜å¡ç‰‡</label>
                   <select id="txCard" onchange="recalc()">
                       <option value="UNIOPEN">ä¸­ä¿¡ Uniopen</option>
                       <option value="DBS">æ˜Ÿå±•-å‚³èªªå°æ±º (10%)</option>
                       <option value="CUBE_L3">åœ‹æ³°-CUBE (3%)</option>
                       <option value="FLYGO">å°æ–°-é£›ç‹— (5%)</option>
                       <option value="OTHER">å…¶ä»–</option>
                   </select>
               </div>
           </div>
           <div class="grid-2">
                <div class="form-row"><label>æ”¯ä»˜æ–¹å¼</label>
                    <select id="txMethod" onchange="recalc()">
                        <option value="PHYSICAL">å¯¦é«”å¡/æ„Ÿæ‡‰</option>
                        <option value="ICASH_PAY">icash Pay (+4%)</option>
                        <option value="AUTO_LOAD">è‡ªå‹•åŠ å€¼</option>
                    </select>
                </div>
                <div class="form-row"><label>çµ±ä¸€å“ç‰Œ</label>
                    <select id="txBrand" onchange="recalc()">
                        <option value="NONE">éçµ±ä¸€é›†åœ˜</option>
                        <option value="711">7-11</option><option value="starbucks">æ˜Ÿå·´å…‹</option>
                        <option value="carrefour">å®¶æ¨‚ç¦</option><option value="cosmed">åº·æ˜¯ç¾</option>
                        <option value="others">å…¶ä»–çµ±ä¸€å“ç‰Œ</option>
                    </select>
                </div>
           </div>
           <div class="form-row"><label>é¡å¤–ç´¯ç©æœƒå“¡</label>
                <select id="txMem" onchange="recalc()">
                    <option value="NONE">ç„¡</option><option value="OPEN">OpenPoint</option>
                    <option value="HG">HappyGo</option><option value="HAMI">HamiPoint</option>
                </select>
           </div>
           <div id="prePreview" style="background:#F9F9F9; padding:12px; border-radius:8px; font-size:0.9em; border: 1px solid #EEE;">
               é è¨ˆå›é¥‹ï¼š<span id="preTotal" style="font-weight:bold;">0</span><br>
               <small id="preDetail" style="color:var(--sub);"></small>
           </div>
           <button onclick="commitTx()" class="btn-main">ç¢ºèªæ–°å¢ç´€éŒ„</button>
       </div>
   </div>

   <div id="sec-miles" class="section hidden">
       <div class="card">
           <h2>è³‡ç”¢çµ±è¨ˆ (æ›ç®—å¾Œ AM)</h2>
           <div id="assetSummary"></div>
       </div>
       <div class="card">
           <h2>åº«å­˜èª¿æ•´èˆ‡æœŸåˆ</h2>
           <div class="grid-2">
               <select id="adjType">
                   <option value="AM">AM å¯¦é«”é‡Œç¨‹</option><option value="DBS_PT">æ˜Ÿå±•ç©åˆ†</option>
                   <option value="CUBE_PT">å°æ¨¹é»</option><option value="OPEN_PT">OpenPoint</option>
                   <option value="HAMI_PT">HamiPoint</option><option value="HG_PT">HappyGo</option>
               </select>
               <input type="number" id="adjVal" placeholder="+/- æ•¸é‡">
           </div>
           <input type="text" id="adjReason" placeholder="åŸå›  (å¦‚ï¼š1æœˆè–ªè½‰é‡Œç¨‹åŒ¯å…¥)" style="width:100%; margin:8px 0; padding:10px; border-radius:8px; border:1px solid #DDD;">
           <button onclick="commitAdj()" class="btn-main" style="background:var(--secondary);">åŸ·è¡Œè®Šå‹•</button>
       </div>
       <div class="card">
           <h2>é‡Œç¨‹æµæ°´å¸³ (è¿‘æœŸ 10 ç­†)</h2>
           <div class="table-wrapper"><table id="mileLogTable"><thead><tr><th>æ—¥æœŸ</th><th>é¡å‹</th><th>è®Šå‹•(AM)</th><th>èªªæ˜</th></tr></thead><tbody></tbody></table></div>
       </div>
   </div>

   <div id="sec-history" class="section hidden">
       <div class="card">
           <h2>äº¤æ˜“æ­·å²ç´€éŒ„</h2>
           <button onclick="exportExcel()" style="background:#2ecc71; color:white; border:none; padding:8px 15px; border-radius:6px; margin-bottom:10px; cursor:pointer;">åŒ¯å‡º Excel</button>
           <div class="table-wrapper"><table id="txTable"><thead><tr><th>æ—¥æœŸ</th><th>é …ç›®</th><th>å›é¥‹</th><th>æ“ä½œ</th></tr></thead><tbody></tbody></table></div>
       </div>
   </div>

   <div id="sec-settings" class="section hidden">
       <div class="card">
           <h2>é‡Œç¨‹ç›®æ¨™èˆ‡æ¯”ä¾‹è¨­å®š</h2>
           <div class="grid-2">
                <div class="form-row"><label>ç›®æ¨™åç¨±</label><input type="text" id="setGoalName"></div>
                <div class="form-row"><label>ç›®æ¨™æ•¸å€¼ (AM)</label><input type="number" id="setGoalTarget"></div>
           </div>
           <h3>é»æ•¸å…Œæ› AM æ¯”ä¾‹ (1 é» = ? AM)</h3>
           <div id="rateInputs" class="grid-2" style="font-size: 0.85em;"></div>
           <button onclick="saveSettings()" class="btn-main" style="margin-top:15px;">å„²å­˜ä¸¦å¥—ç”¨</button>
       </div>
       <div class="card">
           <h2>æ”¯å‡ºé¡åˆ¥ä½”æ¯”</h2>
           <canvas id="statChart"></canvas>
       </div>
       <button onclick="clearAll()" style="width:100%; color:var(--danger); background:none; border:1px solid var(--danger); padding:10px; border-radius:8px;">æ¸…ç©ºæ‰€æœ‰è³‡æ–™</button>
   </div>
</div>

<div class="nav-bar">
   <div class="nav-item active" onclick="nav('entry')">è¨˜å¸³</div>
   <div class="nav-item" onclick="nav('miles')">é‡Œç¨‹</div>
   <div class="nav-item" onclick="nav('history')">æ­·å²</div>
   <div class="nav-item" onclick="nav('settings')">è¨­å®š</div>
</div>

<script>
   // 1. è³‡æ–™åˆå§‹åŒ– (åŒ…å«å®Œæ•´æ¯”ä¾‹æ¸…å–®)
   let state = JSON.parse(localStorage.getItem('am_uni_pro_v5')) || {
       records: [], adjusts: [],
       goal: { name: "é‡Œç¨‹ç›®æ¨™", target: 50000 },
       rates: { 
           AM: 1, DBS_PT: 2, CUBE_PT: 0.36, OPEN_PT: 0.25, 
           HAMI_PT: 0.33, HG_PT: 0.25, TS_PT: 0.55 
       }
   };

   const LIMITS = { DBS: 11363, UNI_åŠ ç¢¼: 12500, ICASH: 3750 };

   // 2. æ ¸å¿ƒçµ±è¨ˆé‚è¼¯
   function getMonthStats() {
       const m = new Date().getMonth();
       const mRecs = state.records.filter(r => new Date(r.date).getMonth() === m);
       const brands = new Set(mRecs.filter(r => r.brand !== 'NONE').map(r => r.brand));
       const uniSpent = mRecs.filter(r => r.cardKey === 'UNIOPEN').reduce((s, r) => s + r.amt, 0);
       const icashSpent = mRecs.filter(r => r.cardKey === 'UNIOPEN' && r.method === 'ICASH_PAY').reduce((s, r) => s + r.amt, 0);
       const dbsSpent = mRecs.filter(r => r.cardKey === 'DBS').reduce((s, r) => s + r.amt, 0);
       return { brandCount: brands.size, brands: Array.from(brands), uniSpent, icashSpent, dbsSpent };
   }

   function recalc() {
       const amt = parseFloat(document.getElementById('txAmt').value) || 0;
       const card = document.getElementById('txCard').value;
       const brand = document.getElementById('txBrand').value;
       const method = document.getElementById('txMethod').value;
       const stats = getMonthStats();

       let amV = 0; let opV = 0; let det = "";

       if (card === 'UNIOPEN') {
           let rate = 0.03; // åŸºæœ¬ 3%
           if (stats.brandCount >= 5 || (brand!=='NONE' && !stats.brands.includes(brand) && stats.brandCount+1 >= 5)) rate += 0.04;
           if (method === 'ICASH_PAY') rate += 0.04;
           opV = Math.round(amt * rate);
           det = `ä¸­ä¿¡ Uniopen (ä»¥ ${Math.round(rate*100)}% è¨ˆç®—)`;
           document.getElementById('preTotal').innerText = opV + " OPENPOINT";
       } else if (card === 'DBS') {
           let rate = (stats.dbsSpent < LIMITS.DBS) ? 0.1 : 0.012;
           amV = Math.round(amt * rate * state.rates.DBS_PT);
           det = `æ˜Ÿå±•å‚³èªªå°æ±º (ç´„ ${amV} AM)`;
           document.getElementById('preTotal').innerText = amV + " AM";
       } else if (card === 'CUBE_L3') {
           amV = Math.round(amt * 0.03 * state.rates.CUBE_PT);
           document.getElementById('preTotal').innerText = amV + " AM";
       }
       document.getElementById('preDetail').innerText = det;
   }

   // 3. å‹•ä½œåŸ·è¡Œ
   function commitTx() {
       const amt = parseFloat(document.getElementById('txAmt').value);
       if(!amt) return;
       state.records.unshift({
           id: Date.now(), date: document.getElementById('txDate').value,
           cat: document.getElementById('txCat').value, desc: document.getElementById('txDesc').value,
           amt, cardKey: document.getElementById('txCard').value, 
           method: document.getElementById('txMethod').value, brand: document.getElementById('txBrand').value,
           memKey: document.getElementById('txMem').value
       });
       save();
       alert("è¨˜å¸³æˆåŠŸï¼");
   }

   function commitAdj() {
       const val = parseFloat(document.getElementById('adjVal').value);
       if(!val) return;
       state.adjusts.unshift({
           id: Date.now(), date: new Date().toLocaleDateString(),
           type: document.getElementById('adjType').value, amt: val, reason: document.getElementById('adjReason').value
       });
       save();
       alert("åº«å­˜è®Šå‹•å·²å­˜æª”");
   }

   // 4. UI æ¸²æŸ“
   function refreshUI() {
       const s = getMonthStats();
       const totalAM = calcTotalAM();
       
       document.getElementById('currentMilesDisp').innerText = Math.round(totalAM).toLocaleString();
       document.getElementById('targetMilesDisp').innerText = state.goal.target.toLocaleString();
       document.getElementById('goalNameDisp').innerText = state.goal.name;
       document.getElementById('goalBar').style.width = Math.min(100, (totalAM/state.goal.target)*100) + "%";

       document.getElementById('dbsSpentDisp').innerText = Math.round(s.dbsSpent).toLocaleString();
       document.getElementById('dbsBar').style.width = Math.min(100, (s.dbsSpent/LIMITS.DBS)*100) + "%";

       document.getElementById('uniStatus').innerText = `${s.brandCount} å“ç‰Œ (${s.brandCount>=5?'7%+':'3%'})`;
       document.getElementById('uniBar').style.width = Math.min(100, (s.uniSpent/LIMITS.UNI_åŠ ç¢¼)*100) + "%";

       document.getElementById('icashSpentDisp').innerText = Math.round(s.icashSpent).toLocaleString();
       document.getElementById('icashBar').style.width = Math.min(100, (s.icashSpent/LIMITS.ICASH)*100) + "%";
       
       document.querySelectorAll('.chip').forEach(c => c.classList.toggle('active', s.brands.includes(c.dataset.brand)));

       renderAsset();
       renderHistory();
       renderLog();
   }

   function calcTotalAM() {
       let m = state.records.reduce((sum, r) => {
           if(r.cardKey === 'DBS') return sum + (r.amt * 0.1 * state.rates.DBS_PT);
           if(r.cardKey === 'CUBE_L3') return sum + (r.amt * 0.03 * state.rates.CUBE_PT);
           if(r.cardKey === 'UNIOPEN') {
               const s = getMonthStats(); // å‹•æ…‹æŠ“å–ä»»å‹™ç‹€æ…‹
               let rate = (s.brandCount>=5?0.07:0.03) + (r.method==='ICASH_PAY'?0.04:0);
               return sum + (r.amt * rate * state.rates.OPEN_PT);
           }
           return sum + (r.amt * 0.003); // å…¶ä»–é è¨­
       }, 0);
       state.adjusts.forEach(a => m += a.amt * (state.rates[a.type] || 0));
       return m;
   }

   function renderAsset() {
       const s = getMonthStats();
       const assets = { AM: 0, DBS_PT: 0, CUBE_PT: 0, OPEN_PT: 0, HAMI_PT: 0, HG_PT: 0 };
       state.records.forEach(r => {
           if(r.cardKey === 'DBS') assets.DBS_PT += r.amt * 0.1;
           if(r.cardKey === 'CUBE_L3') assets.CUBE_PT += r.amt * 0.03;
           if(r.cardKey === 'UNIOPEN') {
               let rate = (s.brandCount>=5?0.07:0.03) + (r.method==='ICASH_PAY'?0.04:0);
               assets.OPEN_PT += r.amt * rate;
           }
       });
       state.adjusts.forEach(a => assets[a.type] += a.amt);

       document.getElementById('assetSummary').innerHTML = Object.entries(assets).map(([k,v]) => `
           <div class="stat-box" style="border-bottom: 1px solid #EEE; padding: 4px 0;">
               <span>${k}</span><span>${Math.round(v).toLocaleString()} (â‰ˆ ${Math.round(v * state.rates[k] || 0)} AM)</span>
           </div>
       `).join('');
   }

   function renderHistory() {
       const s = getMonthStats();
       document.querySelector('#txTable tbody').innerHTML = state.records.map(r => {
           let rw = "";
           if(r.cardKey === 'UNIOPEN') {
               let rate = (s.brandCount>=5?0.07:0.03) + (r.method==='ICASH_PAY'?0.04:0);
               rw = `<span class="reward-op">${Math.round(r.amt * rate)} OP</span>`;
           } else if(r.cardKey === 'DBS') {
               rw = `<span class="reward-am">${Math.round(r.amt * 0.1 * state.rates.DBS_PT)} AM</span>`;
           } else { rw = `<span>-</span>`; }
           return `<tr><td>${r.date.slice(5)}</td><td><b>${r.desc}</b><br><span class="tag">${r.cat}</span></td><td>${rw}</td><td><button onclick="delRec(${r.id})" style="border:none; color:red; background:none;">åˆª</button></td></tr>`;
       }).join('');
   }

   function renderLog() {
        document.querySelector('#mileLogTable tbody').innerHTML = state.adjusts.slice(0, 10).map(a => `
            <tr><td>${a.date}</td><td>èª¿æ•´</td><td style="color:${a.amt>=0?'green':'red'}">${Math.round(a.amt * state.rates[a.type])}</td><td>${a.reason}</td></tr>
        `).join('');
   }

   function saveSettings() {
       state.goal.name = document.getElementById('setGoalName').value;
       state.goal.target = parseInt(document.getElementById('setGoalTarget').value);
       Object.keys(state.rates).forEach(k => {
           const input = document.getElementById('rate_'+k);
           if(input) state.rates[k] = parseFloat(input.value);
       });
       save();
       alert("è¨­å®šå„²å­˜ä¸¦é‡æ–°è¨ˆç®—å®Œæˆ");
   }

   function exportExcel() {
       const data = state.records.map(r => ({ æ—¥æœŸ: r.date, åˆ†é¡: r.cat, é …ç›®: r.desc, é‡‘é¡: r.amt, å¡ç‰‡: r.cardKey, æ–¹å¼: r.method }));
       const ws = XLSX.utils.json_to_sheet(data);
       const wb = XLSX.utils.book_new();
       XLSX.utils.book_append_sheet(wb, ws, "æ¶ˆè²»ç´€éŒ„");
       XLSX.writeFile(wb, "é‡Œç¨‹å›é¥‹ç›£è¦–_åŒ¯å‡º.xlsx");
   }

   function renderChart() {
       const cats = ["é¤é£²ç¾é£Ÿ", "äº¤é€šå‡ºè¡Œ", "è³¼ç‰©æ¶ˆè²»", "å±…å®¶ç”Ÿæ´»", "ä¼‘é–’å¨›æ¨‚", "å…¶ä»–"];
       const data = cats.map(c => state.records.reduce((sum, r) => r.cat === c ? sum + r.amt : sum, 0));
       const ctx = document.getElementById('statChart').getContext('2d');
       if(window.myChart) window.myChart.destroy();
       window.myChart = new Chart(ctx, { type: 'doughnut', data: { labels: cats, datasets: [{ data, backgroundColor: ['#FF6384','#36A2EB','#FFCE56','#4BC0C0','#9966FF','#FF9F40'] }] }});
   }

   function nav(id) {
       document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
       document.getElementById('sec-' + id).classList.remove('hidden');
       document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
       event.currentTarget.classList.add('active');
       if(id === 'settings') renderChart();
   }

   function save() { localStorage.setItem('am_uni_pro_v5', JSON.stringify(state)); refreshUI(); }
   function delRec(id) { if(confirm("ç¢ºå®šåˆªé™¤ï¼Ÿ")) { state.records = state.records.filter(r=>r.id!==id); save(); } }
   function clearAll() { if(confirm("é€™å°‡æœƒæ¸…é™¤æ‰€æœ‰è¨˜å¸³ç´€éŒ„èˆ‡åº«å­˜èª¿æ•´ï¼Œç¢ºå®šå—ï¼Ÿ")) { localStorage.clear(); location.reload(); } }

   // åˆå§‹åŒ–
   document.getElementById('txDate').valueAsDate = new Date();
   document.getElementById('setGoalName').value = state.goal.name;
   document.getElementById('setGoalTarget').value = state.goal.target;
   document.getElementById('rateInputs').innerHTML = Object.keys(state.rates).map(k => `
        <div class="form-row"><label>${k} å…Œæ›æ¯”</label><input type="number" step="0.01" id="rate_${k}" value="${state.rates[k]}"></div>
   `).join('');
   refreshUI();
</script>
</body>
</html>

